{% extends "base.html" %}

{% load custom_filters %}

{% block title %}–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞{% endblock %}

{% block content %}
<h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}

    <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã -->
    {% if existing_files %}
        <h3>–ü—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h3>
        {% for file in existing_files %}
            <div>
                <a href="{{ file.file.url }}" target="_blank">
                    {{ file.file.name|basename }}
                </a>
            </div>
        {% endfor %}
    {% endif %}

    <!-- –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã -->
    <div class="custom-file-upload">
        <button type="button" id="upload-button" class="btn btn-primary">
            üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã
        </button>
        <input type="file" id="files" name="files" multiple style="display: none;">
    </div>

    <ul id="file-list"></ul>

    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <a href="{% url 'todo:task_list' %}">–û—Ç–º–µ–Ω–∞</a>
</form>

<script>
document.getElementById('upload-button').addEventListener('click', function() {
    document.getElementById('files').click();
});

document.getElementById('files').addEventListener('change', function(e) {
    const files = e.target.files;
    if (files.length > 0) {
        let fileList = '';
        for (let i = 0; i < files.length; i++) {
            fileList += '<li>' + files[i].name + '</li>';
        }
        document.getElementById('file-list').innerHTML = '<h4>–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:</h4><ul>' + fileList + '</ul>';
        // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Ñ–∞–π–ª—ã –≤—ã–±—Ä–∞–Ω—ã
        document.getElementById('upload-button').textContent = 'üìé –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë —Ñ–∞–π–ª—ã';
    }
});
</script>

{% endblock %}