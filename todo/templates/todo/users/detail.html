<!-- todo/templates/todo/users/detail.html -->
{% extends "base.html" %}

{% block title %}{{ profile.username }}{% endblock %}

{% block content %}

{% if not profile.telegram_profile %}
  {% if telegram_link_code %}
    <a href="https://t.me/{{ TELEGRAM_BOT_USERNAME }}?start={{ telegram_link_code }}"
       class="btn btn-primary"
       target="_blank">
      Привязать Telegram
    </a>
  {% endif %}
{% endif %}

<div class="profile">
    {% csrf_token %}
    <div class="profile-header">
        <h2>{{ profile.username }}</h2>
        <span class="role">{{ profile.get_role_display }}</span>
    </div>

    <div class="profile-stats">
        <div class="stat-card">
            <h4>Всего задач</h4>
            <p>{{ profile.tasks.count }}</p>
        </div>
        <div class="stat-card">
            <h4>Завершено</h4>
            <p>{{ profile.completed_tasks_count }}</p>
        </div>
        <div class="stat-card">
            <h4>В работе</h4>
            <p>{{ profile.in_progress_tasks_count }}</p>
        </div>
        <div class="stat-card">
            <h4>Просрочено</h4>
            <p>{{ profile.overdue_tasks_count }}</p>
        </div>
    </div>

    <h3>Назначенные задачи</h3>
    <ul class="tasks-list">
    {% for task in profile.tasks.all %}
        <li class="task-item">
            <a href="{% url 'todo:task_detail' task.pk %}">{{ task.title }}</a>
            ({{ task.get_status_display }})
        </li>
    {% empty %}
        <li>Нет назначенных задач</li>
    {% endfor %}
    </ul>

    <h3>Созданные задачи</h3>
    <ul class="tasks-list">
    {% for task in profile.created_tasks.all %}
        <li class="task-item">
            <a href="{% url 'todo:task_detail' task.pk %}">{{ task.title }}</a>
            ({{ task.get_status_display }})
        </li>
    {% empty %}
        <li>Нет созданных задач</li>
    {% endfor %}
    </ul>

    <div class="profile-actions">
        <a href="{% url 'todo:user_list' %}" class="btn btn-secondary">Назад к списку</a>
    </div>
</div>
{% endblock %}