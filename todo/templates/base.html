<!-- todo/templates/base.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Корпоративный To-Do List{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="{% if request.user.is_authenticated %}authenticated{% endif %}">

    {% if request.user.is_authenticated %}
    <header class="app-header">
        <div class="header-container">
            <div class="header-right">
                <div class="header-user-info">
                    <a href="{% url 'todo:user_detail' request.user.id %}" class="header-user-link">
                        Привет, {{ request.user.first_name }} ({{ request.user.get_role_display }})
                    </a>
                </div>
                <button class="user-dropdown-btn" id="user-menu-toggle">
                    <i class="fas fa-user"></i>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-menu" id="user-dropdown-menu">
                    <div class="dropdown-item">
                        <i class="fab fa-telegram-plane"></i> Телеграм:
                        {% if request.user.telegram_profile %}
                            {% if request.user.telegram_profile.username %}
                                <a href="https://t.me/{{ request.user.telegram_profile.username }}" target="_blank" style="color: inherit; text-decoration: none;">
                                    @{{ request.user.telegram_profile.username }}
                                </a>
                            {% else %}
                                #{{ request.user.telegram_profile.telegram_id }}
                            {% endif %}
                        {% else %}
                            —
                        {% endif %}
                    </div>
                    <div class="dropdown-divider"></div>
                    <form method="post" action="{% url 'todo:logout' %}" style="display: contents;">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item logout" style="background: none; border: none; width: 100%; text-align: left; padding: 10px 16px; cursor: pointer;">
                            <i class="fas fa-sign-out-alt"></i> Выйти
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </header>
    {% endif %}

    <main class="container">
        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <p>&copy; 2025 Корпоративный To-Do List</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('user-menu-toggle');
            const dropdownMenu = document.getElementById('user-dropdown-menu');

            toggleBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });

            // Закрыть меню при клике вне его
            document.addEventListener('click', function(e) {
                if (!toggleBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>